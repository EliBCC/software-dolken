!!! warning "These module docs are in beta and may be incomplete."

# modm:processing:protothread: Protothreads

Protothreads are extremely lightweight stackless threads designed for
severely memory constrained systems, such as small embedded systems or
wireless sensor network nodes. Protothreads provide linear code execution
for event-driven systems implemented in C. Protothreads can be used with or
without an underlying operating system to provide blocking event-handlers.

Protothreads provide sequential flow of control without complex state
machines or full multi-threading.

Since they implement some kind of cooperative multi-threading, Protothreads
are non-preemptable. Therefore, a context switch can only take place on
blocking operations, which means you don't need complex synchronization.

Protothreads are also stackless, so local variables are not preserved across
context switches, and must instead become member variables of the
`modm::Protothread` subclass

A protothread runs within a single function (`modm::Protothread::run()`) and
cannot span over other functions. A protothread may call normal functions,
but cannot block inside a called function. Blocking inside nested function
calls is instead made by spawning a separate protothread for each
potentially blocking function.

The protothread concept was developed by Adam Dunkels and Oliver Schmidt:
http://dunkels.com/adam/pt

Originally ported to C++ for use by Hamilton Jet (www.hamiltonjet.co.nz) by
Ben Hoyt, but stripped down for public release.


## Example

```cpp
#include <modm/processing/protothread.hpp>

using Led = GpioB0;

class BlinkingLight : public modm::pt::Protothread
{
public:
    bool
    run()
    {
        PT_BEGIN();

        // set everything up
        Led::setOutput();
        Led::set();

        while (true)
        {
            timeout.restart(100);
            Led::set();
            PT_WAIT_UNTIL(timeout.isExpired());

            timeout.restart(200);
            Led::reset();
            PT_WAIT_UNTIL(timeout.isExpired());
        }

        PT_END();
    }

private:
    modm::ShortTimeout timeout;
};
// ...

BlinkingLight light;

while (1) {
    light.run();
}
```






## Dependencies

<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: modm:processing:protothread Pages: 1 -->
<svg width="184pt" height="135pt"
 viewBox="0.00 0.00 184.00 135.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 131)">
<title>modm:processing:protothread</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-131 180,-131 180,4 -4,4"/>
<!-- modm_processing_protothread -->
<g id="node1" class="node"><title>modm_processing_protothread</title>
<polygon fill="lightgrey" stroke="black" stroke-width="2" points="129.5,-53 47.5,-53 47.5,-0 129.5,-0 129.5,-53"/>
<text text-anchor="middle" x="88.5" y="-37.8" font-family="Times New Roman,serif" font-size="14.00">modm:</text>
<text text-anchor="middle" x="88.5" y="-22.8" font-family="Times New Roman,serif" font-size="14.00">processing:</text>
<text text-anchor="middle" x="88.5" y="-7.8" font-family="Times New Roman,serif" font-size="14.00">protothread</text>
</g>
<!-- modm_architecture -->
<g id="node2" class="node"><title>modm_architecture</title>
<g id="a_node2"><a xlink:href="../modm-architecture" xlink:title="modm:
architecture">
<polygon fill="lightgrey" stroke="black" points="81,-127 0,-127 0,-89 81,-89 81,-127"/>
<text text-anchor="middle" x="40.5" y="-111.8" font-family="Times New Roman,serif" font-size="14.00">modm:</text>
<text text-anchor="middle" x="40.5" y="-96.8" font-family="Times New Roman,serif" font-size="14.00">architecture</text>
</a>
</g>
</g>
<!-- modm_processing_protothread&#45;&gt;modm_architecture -->
<g id="edge1" class="edge"><title>modm_processing_protothread&#45;&gt;modm_architecture</title>
<path fill="none" stroke="black" d="M73.0483,-53.0919C67.8411,-61.7163 62.0164,-71.3634 56.7496,-80.0867"/>
<polygon fill="black" stroke="black" points="53.6847,-78.3914 51.5122,-88.7611 59.6771,-82.0095 53.6847,-78.3914"/>
</g>
<!-- modm_processing -->
<g id="node3" class="node"><title>modm_processing</title>
<g id="a_node3"><a xlink:href="../modm-processing" xlink:title="modm:
processing">
<polygon fill="lightgrey" stroke="black" points="176,-127 99,-127 99,-89 176,-89 176,-127"/>
<text text-anchor="middle" x="137.5" y="-111.8" font-family="Times New Roman,serif" font-size="14.00">modm:</text>
<text text-anchor="middle" x="137.5" y="-96.8" font-family="Times New Roman,serif" font-size="14.00">processing</text>
</a>
</g>
</g>
<!-- modm_processing_protothread&#45;&gt;modm_processing -->
<g id="edge2" class="edge"><title>modm_processing_protothread&#45;&gt;modm_processing</title>
<path fill="none" stroke="black" d="M104.274,-53.0919C109.589,-61.7163 115.535,-71.3634 120.912,-80.0867"/>
<polygon fill="black" stroke="black" points="118.032,-82.0846 126.258,-88.7611 123.991,-78.4117 118.032,-82.0846"/>
</g>
</g>
</svg>

